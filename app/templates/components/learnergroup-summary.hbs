{{learnergroup-header learnerGroup=learnerGroup sortUsersBy=sortUsersBy}}

<div class='detail-view-details'>
  <section class='detail-block overview'>
    {{#if (is-fulfilled learnerGroup.usersOnlyAtThisLevel)}}
      <div class='detail-content'>
        {{learnergroup-user-list
          users=(await learnerGroup.usersOnlyAtThisLevel)
          sortBy=sortUsersBy
          setSortBy=this.attrs.setSortUsersBy
          title=(t 'learnerGroups.members')
        }}
      </div>
    {{else}}
      {{fa-icon 'spinner' spin=true}}
    {{/if}}

    <div class='form-container'>
      <div class='form-col-12'>
        <label class='form-label'>{{t "learnerGroups.defaultLocation"}}:</label>
        <div class='form-data'>
          {{#editable-field
            value=(if location location (t 'general.clickToEdit'))
            save=(action 'changeLocation')
            close=(action 'revertLocationChanges')
            as |isSaving save close|
          }}
            {{one-way-input
              value=location
              update=(action (mut location))
              onenter=save
              onescape=close
              disabled=isSaving
              focusOut=(action 'addErrorDisplayFor' 'location')
            }}
            {{#if (and (v-get this 'location' 'isInvalid') (is-in showErrorsFor 'location'))}}
              <span class="validation-error-message">{{v-get this 'location' 'message'}}</span>
            {{/if}}
          {{/editable-field}}
        </div>
        <label class='form-label'>{{t "learnerGroups.defaultInstructors"}}:</label>
        <div class='form-data clickable link'>
          {{#if (is-fulfilled learnerGroup.allInstructors)}}
            {{#liquid-if manageInstructors class='crossFade'}}
              {{learnergroup-instructor-manager
                learnerGroup=learnerGroup
                save=(action 'saveInstructors')
                close=(toggle-action 'manageInstructors' this)
              }}
            {{else}}
              <span class='clickable link' {{action (toggle 'manageInstructors' this)}}>
                {{#if (get (await learnerGroup.allInstructors) 'length')}}
                  {{join '; ' (map-by 'fullName' (sort-by 'lastName' (await learnerGroup.allInstructors)))}}
                {{else}}
                  {{t 'general.none'}}
                {{/if}}
              </span>
            {{/liquid-if}}
          {{else}}
            {{fa-icon 'spinner' spin=true}}
          {{/if}}
        </div>
        <label class='form-label'>{{t "learnerGroups.associatedCourses"}}:</label>
        <div class='form-data'>
          {{#if (is-fulfilled learnerGroup.courses)}}
            {{#if (get (await learnerGroup.courses) 'length')}}
              {{join '; ' (map-by 'title' (await learnerGroup.courses))}}
            {{else}}
              {{t 'general.none'}}
            {{/if}}
          {{else}}
            {{fa-icon 'spinner' spin=true}}
          {{/if}}
        </div>
      </div>
    </div>
  </section>


  {{learnergroup-subgroup-list parentGroup=learnerGroup}}

  <section class='detail-block cohortmembers'>
    {{#if (is-fulfilled cohortMembersNotInAnyGroup)}}
      <div class='detail-content'>
        {{learnergroup-user-list
          users=(await cohortMembersNotInAnyGroup)
          sortBy=sortUsersBy
          setSortBy=this.attrs.setSortUsersBy
          title=(t 'learnerGroups.cohortMembersNotInGroup' groupTitle=learnerGroup.topLevelGroup.title)
        }}
      </div>
    {{else}}
      {{fa-icon 'spinner' spin=true}}
    {{/if}}
  </section>
</div>
