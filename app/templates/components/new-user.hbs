<div class="new-result-title">{{t 'user.new'}}</div>

<div class="detail-content form-container">
  <div class="form-col-12 multi-row">
    <label class="form-label">{{t 'general.createNew'}}:</label>
    <div class="form-data">
      {{click-choice-buttons
        buttonContent1=(t 'general.nonStudent')
        buttonContent2=(t 'general.student')
        firstChoicePicked=nonStudentMode
        action='setNonStudentMode'
      }}
    </div>
    <label class="form-label">{{t "user.firstName"}}:</label>
    <div class="form-data">
      {{one-way-input
        value=firstName
        update=(action (mut firstName))
        onenter=(action "save")
        onescape=(action this.attrs.close)
        focusOut=(action 'addErrorDisplayFor' 'firstName')
      }}
      {{#if (and (v-get this 'firstName' 'isInvalid') (is-in showErrorsFor 'firstName'))}}
        <span class="validation-error-message">{{v-get this 'firstName' 'message'}}</span>
      {{/if}}
    </div>
    <label class="form-label">{{t "user.middleName"}}:</label>
    <div class="form-data">
      {{one-way-input
        value=middleName
        update=(action (mut middleName))
        onenter=(action "save")
        onescape=(action this.attrs.close)
        focusOut=(action 'addErrorDisplayFor' 'middleName')
      }}
      {{#if (and (v-get this 'middleName' 'isInvalid') (is-in showErrorsFor 'middleName'))}}
        <span class="validation-error-message">{{v-get this 'middleName' 'message'}}</span>
      {{/if}}
    </div>
    <label class="form-label">{{t "user.lastName"}}:</label>
    <div class="form-data">
      {{one-way-input
        value=lastName
        update=(action (mut lastName))
        onenter=(action "save")
        onescape=(action this.attrs.close)
        focusOut=(action 'addErrorDisplayFor' 'lastName')
      }}
      {{#if (and (v-get this 'lastName' 'isInvalid') (is-in showErrorsFor 'lastName'))}}
        <span class="validation-error-message">{{v-get this 'lastName' 'message'}}</span>
      {{/if}}
    </div>
    <label class="form-label">{{t "general.campusId"}}:</label>
    <div class="form-data">
      {{one-way-input
        value=campusId
        update=(action (mut campusId))
        onenter=(action "save")
        onescape=(action this.attrs.close)
        focusOut=(action 'addErrorDisplayFor' 'campusId')
      }}
      {{#if (and (v-get this 'campusId' 'isInvalid') (is-in showErrorsFor 'campusId'))}}
        <span class="validation-error-message">{{v-get this 'campusId' 'message'}}</span>
      {{/if}}
    </div>
    <label class="form-label">{{t "user.otherId"}}:</label>
    <div class="form-data">
      {{one-way-input
        value=otherId
        update=(action (mut otherId))
        onenter=(action "save")
        onescape=(action this.attrs.close)
        focusOut=(action 'addErrorDisplayFor' 'otherId')
      }}
      {{#if (and (v-get this 'otherId' 'isInvalid') (is-in showErrorsFor 'otherId'))}}
        <span class="validation-error-message">{{v-get this 'otherId' 'message'}}</span>
      {{/if}}
    </div>
    <label class="form-label">{{t "general.email"}}:</label>
    <div class="form-data">
      {{one-way-input
        value=email
        update=(action (mut email))
        onenter=(action "save")
        onescape=(action this.attrs.close)
        focusOut=(action 'addErrorDisplayFor' 'email')
      }}
      {{#if (and (v-get this 'email' 'isInvalid') (is-in showErrorsFor 'email'))}}
        <span class="validation-error-message">{{v-get this 'email' 'message'}}</span>
      {{/if}}
    </div>
    <label class="form-label">{{t "general.phone"}}:</label>
    <div class="form-data">
      {{one-way-input
        value=phone
        update=(action (mut phone))
        onenter=(action "save")
        onescape=(action this.attrs.close)
        focusOut=(action 'addErrorDisplayFor' 'phone')
      }}
      {{#if (and (v-get this 'phone' 'isInvalid') (is-in showErrorsFor 'phone'))}}
        <span class="validation-error-message">{{v-get this 'phone' 'message'}}</span>
      {{/if}}
    </div>
    <label class="form-label">{{t "user.username"}}:</label>
    <div class="form-data">
      {{one-way-input
        value=username
        update=(action (mut username))
        onenter=(action "save")
        onescape=(action this.attrs.close)
        focusOut=(action 'addErrorDisplayFor' 'username')
      }}
      {{#if (and (v-get this 'username' 'isInvalid') (is-in showErrorsFor 'username'))}}
        <span class="validation-error-message">{{v-get this 'username' 'message'}}</span>
      {{/if}}
    </div>
    <label class="form-label">{{t "user.password"}}:</label>
    <div class="form-data">
      {{one-way-input
        value=password
        update=(action (mut password))
        onenter=(action "save")
        onescape=(action this.attrs.close)
        focusOut=(action 'addErrorDisplayFor' 'password')
      }}
      {{#if (and (v-get this 'password' 'isInvalid') (is-in showErrorsFor 'password'))}}
        <span class="validation-error-message">{{v-get this 'password' 'message'}}</span>
      {{/if}}
    </div>
    <label class="form-label">{{t "general.primarySchool"}}:</label>
    {{#if (and (is-fulfilled schools) (is-fulfilled bestSelectedSchool))}}
      <div class="form-data form-data-select">
        <select onchange={{action "setSchool" value="target.value"}}>
          {{#each (sort-by 'title' (await schools)) as |school|}}
            <option value={{school.id}} selected={{eq school (await bestSelectedSchool)}}>
              {{school.title}}
            </option>
          {{/each}}
        </select>
      </div>
    {{else}}
      {{fa-icon 'spinner' spin=true}}
    {{/if}}
    {{#unless nonStudentMode class='vertical'}}
      <label class="form-label">{{t "general.primaryCohort"}}:</label>
      {{#if (and (is-fulfilled bestSelectedSchool.cohorts) (is-fulfilled bestSelectedCohort))}}
        <div class="form-data form-data-select">
          <select onchange={{action "setPrimaryCohort" value="target.value"}}>
            {{#each (sort-by 'programYear.program.title' (sort-by 'title' (get (await bestSelectedSchool) 'cohorts'))) as |cohort|}}
              <option value={{cohort.id}} selected={{eq cohort (await bestSelectedCohort)}}>
                {{cohort.programYear.program.title}} {{cohort.title}}
              </option>
            {{/each}}
          </select>
        </div>
      {{else}}
        {{fa-icon 'spinner' spin=true}}
      {{/if}}
    {{/unless}}
  </div>

  <div class="form-col-6 form-data-submit">
    <button class='done text' {{action 'save'}} disabled={{or isSaving (is-pending bestSelectedCohort)  (and (not nonStudentMode) (is-pending bestSelectedSchool))}}>
      {{#if isSaving}}
        {{fa-icon 'spinner' spin=true}}
      {{else}}
        {{t 'general.done'}}
      {{/if}}
    </button>
    <button class='cancel text' {{action (action this.attrs.close)}}>{{t 'general.cancel'}}</button>
  </div>
</div>
