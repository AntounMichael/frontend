---
#really we're using node_js but this works with the osx OS
language: objective-c
#we use OSX here because phantomJS2 isn't super stable on Linux
os: osx
sudo: false

env:
  global:
    #AWS credentials for ilios travis-deploy user
  - secure: kLY+xxJKxi/srSsyjphkaF8y2dagUTBBzBWjkO+uEtR5K5OxURHCFmCL9cuM4VbSBkvRaoPuzxNeeRP4Np3x1/Xiv1so60ZBo+XPW02W84HZWpSc2QxwlSLaU6KD/K7K7HZ+dh3ky91nQFTqlGPJcoWHy+aCJkLDlgWLYZwxc0Q=
  - secure: ITd6yf8q7kimvTFERMEXkGIWjI8g/SWgt6kP7iiTB+7IqBKY0pG2IdU3I/I8HifTnophUsZJEYbZ6Dj+OnAgWjTo1HSYoltlwXlO0qigw0exI9G8lmpJ1Ww8lSuGhUAop3YpUwrIVmE0PRPaEduTRJTCzUt6yKq4FjGHC3SSHFU=

cache:
  directories:
    - node_modules
    - travis-phantomjs

matrix:
  fast_finish: true

before_install:
  - rm -rf ~/.nvm
  - git clone https://github.com/creationix/nvm.git ~/.nvm
  - source ~/.nvm/nvm.sh
  - nvm install v5
  - PHANTOM_DIR=$PWD/../travis-phantom
  - if [ ! -d $PHANTOM_DIR ]; then wget https://bitbucket.org/ariya/phantomjs/downloads/phantomjs-2.0.0-macosx.zip -O phantomjs.zip; fi
  - if [ ! -d $PHANTOM_DIR ]; then unzip phantomjs.zip; fi
  - if [ ! -d $PHANTOM_DIR ]; then mv phantomjs-2.0.0-macosx $PHANTOM_DIR; fi
  - export PATH=$PHANTOM_DIR/bin:$PATH
  - phantomjs -v
  - npm set progress=false
  - npm config set spin false
  - npm install -g bower
  - travis_retry gem install scss-lint --no-ri --no-rdoc

install:
  - travis_retry npm install --no-optional
  - travis_retry bower install

script:
  - scss-lint
  - npm test

after_success:
  - test $TRAVIS_PULL_REQUEST == "false" && test $TRAVIS_BRANCH == "master" && node_modules/.bin/ember deploy production

#encrypted the slack token to post to #info so that it doesn't run on pull requests or forks
notifications:
    slack:
      secure: oloxDKdwXmNHKhh5WSR8DDxA3WJdAnyj+vj/8yawF1zG0tgL4fyPzzFqSpEhfsfgBrJlvxFtSnnsWEIMSMdT1LTwReClyjsy3PFQnHIiLMv/IZUS7ijahXQ4XL+ejfyPV4rJtFuKOLuNMww8uniy705/QkqBYwFUAcXXQ3gV5V8=
